{% extends "core/base_users.html" %}
{% block title %}Listing {{ listing.id }} – Green Square Capital{% endblock %}

{% block content %}
<div class="container py-5">

  <div class="d-flex justify-content-between align-items-start mb-3">
    <div>
      <h2 class="mb-1">{{ listing.source_use|capfirst }} → {{ listing.target_use|capfirst }}</h2>
      <p class="text-muted mb-0">
        {{ listing.country|capfirst }} • {{ listing.county }} • {{ listing.postcode_prefix }}
      </p>
    </div>

    {% if listing.status == "draft" %}
      <span class="badge text-bg-secondary">Draft</span>
    {% elif listing.status == "pending_payment" %}
      <span class="badge text-bg-warning">Pending payment</span>
    {% elif listing.status == "active" %}
      <span class="badge text-bg-success">Active</span>
    {% elif listing.status == "expired" %}
      <span class="badge text-bg-dark">Expired</span>
    {% else %}
      <span class="badge text-bg-light">Unknown</span>
    {% endif %}
  </div>

  <div class="d-flex gap-2 flex-wrap mb-3">
    <a href="{% url 'users:dashboard' %}" class="btn btn-sm btn-outline-secondary">← Back to Dashboard</a>

    {% if listing.status == "draft" or listing.status == "pending_payment" %}
      <a href="{% url 'users:listing_edit' listing.pk %}" class="btn btn-sm btn-primary">
        Edit listing
      </a>

      <a href="{% url 'users:listing_checkout' listing.pk %}" class="btn btn-sm btn-success">
        Continue to payment
      </a>
    {% endif %}
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <p class="mb-2"><strong>Funding:</strong> {{ listing.get_funding_band_display }}</p>
      <p class="mb-2"><strong>Return Type:</strong> {{ listing.get_return_type_display }}</p>
      <p class="mb-2"><strong>Potential Return:</strong> {{ listing.get_return_band_display }}</p>
      <p class="mb-0"><strong>Duration:</strong> {{ listing.duration_days }} days</p>

      {% if listing.active_until %}
        <p class="mb-0 mt-2"><strong>Active until:</strong> {{ listing.active_until|date:"d M Y" }}</p>
      {% endif %}
    </div>
  </div>

  <h4 class="mb-2">Images</h4>
  <div class="row g-3 mb-4">
    {% for img in images %}
      <div class="col-6 col-md-4 col-lg-3">
        <a href="{{ img.file.url }}" target="_blank" rel="noopener">
          <img src="{{ img.file.url }}" class="img-fluid rounded" alt="">
        </a>
      </div>
    {% empty %}
      <div class="col-12">
        <p class="text-muted mb-0">No images uploaded.</p>
      </div>
    {% endfor %}
  </div>

  <h4 class="mb-2">Documents</h4>
  <ul class="list-group mb-4">
    {% for doc in documents %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>{{ doc.file.name }}</span>
        <a class="btn btn-sm btn-outline-primary" href="{{ doc.file.url }}" target="_blank" rel="noopener">Open</a>
      </li>
    {% empty %}
      <li class="list-group-item text-muted">No documents uploaded.</li>
    {% endfor %}
  </ul>

  <a href="{% url 'users:dashboard' %}" class="btn btn-sm btn-outline-secondary">← Back to Dashboard</a>

</div>
{% endblock %}
